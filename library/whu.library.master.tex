\WHUDependency 
  {
    package = { tabularray },
    library = { cover }
  }
\WHUProvideExplLibrary{master}{\whu@date}{\whu@version}{setting for normal master thesis of Wuhan University}


% ---------------------------------- %
% 硕士学位类型：academic, professional %
% ---------------------------------- %
\msg_new:nnn { whu } { invalid-degree-type }
  {
    Invalid~degree~type~`#1'. \\ Please~type~`academic'~or~`professional'. 
  }
\str_new:N \g__whu_master_degree_type_str
\keys_define:nn { whu/master }
  {
    degree-type .choice:,
    degree-type / academic .code:n = { \str_gset:Nn \g__whu_master_degree_type_str { academic } },
    degree-type / professional .code:n = { \str_gset:Nn \g__whu_master_degree_type_str { professional } },
    degree-type .initial:n = academic,
    degree-type / unknown .code:n = { \msg_error:nnn { whu } { invalid-degree-type } {#1} },
  }


\cs_new:Nn \__whu_master_new_cs_academic_and_professional_zh_and_en:nn 
  {
    \cs_new:cn  { __whu_academic_master_ #1 _zh_ #2 : } { }
    \cs_new:cn  { __whu_academic_master_ #1 _en_ #2 : } { }
    \cs_new:cn  { __whu_professional_master_ #1 _zh_ #2 : } { }
    \cs_new:cn  { __whu_professional_master_ #1 _en_ #2 : } { }
  }


% -------------- %
% 不同 type 的设置 %
% -------------- %
\cs_set:Nn \__whu_type_for_library_additional_setting:
  {
    % 用 \AtBeginDocument 可以在 \AtEndPreamble 之后执行，可以覆盖 hyperref 的原始设置
    % https://github.com/Sophanatprime/cus/issues/24#issuecomment-2041074019
    \AtBeginDocument
      { \hypersetup { allcolors = black } }
  }
\cs_set:Nn \__whu_type_for_print_additional_setting:
  {
    \AtBeginDocument
      { \hypersetup { allcolors = black } }
  }



% ------- %
% 封面设置 %
% ------- %
\cs_set:Nn \__whu_cover_output:
  {
    \str_case:Vn \g__whu_master_degree_type_str
      {
        { academic } { \__whu_academic_master_cover: }
        { professional } { \__whu_professional_master_cover: }
      }
  }
\cs_new:Nn \__whu_academic_master_cover: 
  {
    \__whu_academic_master_cover_zh:
    \__whu_if_cleardoublepage:
    \__whu_academic_master_cover_en:
    \__whu_if_cleardoublepage:
  }
\cs_new:Nn \__whu_academic_master_cover_zh: 
  {
    \__whu_academic_master_cover_zh_set:
    \__whu_cover_zh:
  }
\cs_new:Nn \__whu_academic_master_cover_en: 
  {
    \__whu_academic_master_cover_en_set:
    \__whu_cover_en:
  }
\cs_new:Nn \__whu_academic_master_cover_zh_set: 
  {
    \__whu_academic_master_constant_zh_set:
    \__whu_academic_master_information_zh_set:
  }
\cs_new:Nn \__whu_academic_master_cover_en_set: 
  {
    \__whu_academic_master_constant_en_set:
    \__whu_academic_master_information_en_set:
  }
\cs_new:Nn \__whu_academic_master_constant_zh_set: 
  {
    \__whu_master_cover_zh_common_set:
    \__whu_academic_master_constant_zh_initial_set:
    \__whu_academic_master_constant_zh_additional_set:
  }
\cs_new:Nn \__whu_academic_master_constant_en_set: 
  {
    \__whu_master_cover_en_common_set:
    \__whu_academic_master_constant_en_initial_set:
    \__whu_academic_master_constant_en_additional_set:
  }
\cs_new:Nn \__whu_academic_master_information_zh_set:
  {
    \__whu_academic_master_information_zh_initial_set:
    \__whu_academic_master_information_zh_additional_set:
  }
\cs_new:Nn \__whu_academic_master_information_en_set:
  {
    \__whu_academic_master_information_en_initial_set:
    \__whu_academic_master_information_en_additional_set:
  }
\cs_new:Nn \__whu_master_cover_zh_common_set: 
  {
    \__whu_set_information_constant_family:n
      {
        clc/zh                = 分类号,
        secret-level/zh       = 密级,
        udc/zh                = UDC,
        school-id/zh          = 编号,
        author/zh             = 研究生姓名
        student-id/zh         = 学号,
        supervisor/zh         = 指导教师姓名、职称,
        major/zh              = 专业名称,
      }
    \__whu_set_information_family:n
      {
        thesis-type/zh         = 硕士学位论文,
        title/zh               = 武汉大学硕士学位论文 \LaTeX{} 模板,
        department/zh          = 学院,
        author/zh              = 研究生姓名,
        student-id/zh          = 学号,
        supervisor/zh          = 指导教师姓名、职称,
        major/zh               = 专业名称,
      }
  }
\cs_new:Nn \__whu_master_cover_en_common_set:
  {
    \__whu_set_information_constant_family:n
      {
        author/en             = Candidate,
        student-id/en         = Student~Number,
        supervisor/en         = Supervisor,
        major/en              = Major,
        professional-field/en = Speciality,
      }
    \__whu_set_information_family:n
      {
        title/en               = \LaTeX{} Template~for~Master's~Degree~Thesis~of~Wuhan~University,
        department/en          = School,
        author/en              = Candidate,
        student-id/en          = Student~Number,
        supervisor/en          = Supervisor,
        major/en               = Major,
        professional-field/en  = Speciality,
      }
  }
\cs_new:Nn \__whu_academic_master_constant_zh_initial_set: 
  {
    \__whu_set_information_constant_family:n
      {
        professional-field/zh = 研究方向,
      }
  }
\cs_new:Nn \__whu_academic_master_information_zh_initial_set: 
  {
    \__whu_set_information_family:n
      {
        professional-field/zh  = 研究方向,
      }
  }
\cs_new:Nn \__whu_academic_master_constant_en_initial_set: 
  {
    \__whu_set_information_constant_family:n
      {
        professional-field/en = Speciality,
      }
    \__whu_set_information_family:n
      {
        professional-field/en  = Speciality,
      }
  }
\clist_map_function:nN
  {
    \__whu_academic_master_constant_zh_additional_set:,
    \__whu_academic_master_constant_en_additional_set:,
    \__whu_academic_master_information_en_initial_set:,
    \__whu_academic_master_information_zh_additional_set:,
    \__whu_academic_master_information_en_additional_set:,
  }\__whu_new_cs_empty:N


\cs_new:Nn \__whu_professional_master_cover: 
  {
    \__whu_professional_master_cover_zh:
    \__whu_if_cleardoublepage:
    \__whu_professional_master_cover_en:
    \__whu_if_cleardoublepage:
  }
\cs_new:Nn \__whu_professional_master_cover_zh:
  {
    \__whu_professional_master_cover_zh_set:
    \__whu_cover_zh:
  }
\cs_new:Nn \__whu_professional_master_cover_en: 
  {
    \__whu_professional_master_cover_en_set:
    \__whu_cover_en:
  }
\cs_new:Nn \__whu_professional_master_cover_zh_set: 
  {
    \__whu_master_cover_zh_common_set:
    \__whu_professional_master_constant_zh_set:
    \__whu_professional_master_information_zh_set:
  }
\cs_new:Nn \__whu_professional_master_cover_en_set: 
  {
    \__whu_master_cover_en_common_set:
    \__whu_professional_master_constant_en_set:
    \__whu_professional_master_information_en_set:
  }
\cs_new:Nn \__whu_professional_master_constant_zh_set: 
  {
    \__whu_professional_master_constant_zh_initial_set:
    \__whu_professional_master_constant_zh_additional_set:
  }
\cs_new:Nn \__whu_professional_master_information_zh_set:
  {
    \__whu_professional_master_information_zh_initial_set:
    \__whu_professional_master_information_zh_additional_set:
  }
\cs_new:Nn \__whu_professional_master_constant_zh_initial_set: 
  {
    \__whu_set_information_constant_family:n
      {
        major/zh = 专业类别（领域）,
      }
  }
\cs_new:Nn \__whu_professional_master_constant_zh_additional_set: { }
\cs_new:Nn \__whu_professional_master_information_zh_initial_set: 
  {
    \__whu_set_information_family:n
      {
        major/zh = 专业类别（领域）,
      }
  }
\cs_new:Nn \__whu_professional_master_information_zh_additional_set: { }
\cs_new:Nn \__whu_professional_master_constant_en_set: 
  {
    \__whu_professional_master_constant_en_initial_set:
    \__whu_professional_master_constant_en_additional_set:
  }
\cs_new:Nn \__whu_professional_master_constant_en_initial_set: { }
\cs_new:Nn \__whu_professional_master_constant_en_additional_set: { }
\cs_new:Nn \__whu_professional_master_information_en_set:
  {
    \__whu_professional_master_information_en_initial_set:
    \__whu_professional_master_information_en_additional_set:
  }
\cs_new:Nn \__whu_professional_master_information_en_initial_set: { }
\cs_new:Nn \__whu_professional_master_information_en_additional_set: { }

\keys_set:nn { whu/cover/zh/width }
  {
    head-underline     = 2.4cm,
    universitynamelogo = 10cm,
    information        = 0.72\textwidth
  }





% \cs_new:Nn \__whu_academic_master_constant_initial_set:
%   {
%     \cs_set:Nn \__whu_cover_zh_thesis_type_format: { \zihao { 2 } \ziju{1} }
%     
%     
%     \cs_set:Nn \__whu_cover_zh_master_information_content: 
%       {
%         \begin{minipage} [ c ] { \g__whu_cover_zh_information_width_dim }
%           \clist_set:Nx \l__whu_tmpa_clist
%             {
%               \__whu_use_information_constant:nn { author } { zh } ,
%               \__whu_use_information_constant:nn { student-id } { zh } ,
%               \__whu_use_information_constant:nn { supervisor } { zh } ,
%               \__whu_use_information_constant:nn { major } { zh } ,
%               \__whu_use_information_constant:nn { professional-field } { zh }
%             }
%           \clist_set:Nx \l__whu_tmpb_clist
%             {
%               \__whu_use_information:nn { author } { zh },
%               \__whu_use_information:nn { student-id } { zh },
%               \__whu_use_information:nn { supervisor } { zh },
%               \__whu_use_information:nn { major } { zh },
%               \__whu_use_information:nn { professional-field } { zh }
%             }
%           \bool_until_do:nn
%             { \clist_if_empty_p:N \l__whu_tmpa_clist }
%             {
%               \clist_pop:NN \l__whu_tmpa_clist \l__whu_tmpa_tl
%               \clist_pop:NN \l__whu_tmpb_clist \l__whu_tmpb_tl
%               \__whu_spread_box:nn { 4.45cm } { \l__whu_tmpa_tl } :
%               \hspace{1.3em}
%               \l__whu_tmpb_tl
%               \skip_vertical:n { 3ex }
%             }
%         \end{minipage}
%       }
%     \cs_set:Nn \__whu_cover_en_master_information_content: 
%       {
%         \begin{tblr}
%           {
%             cell{1, 3}{2} = { cmd = \textsc },
%             % hlines, vlines,
%             colspec = { X[1,r] X[1,l] },
%             rowsep = 1.5pt
%           }
%           \__whu_use_information_constant:nn { author } { en } : & \__whu_use_information:nn { author } { en } \\
%           \__whu_use_information_constant:nn { student-id } { en } : & \__whu_use_information:nn { student-id } { en } \\
%           \__whu_use_information_constant:nn { supervisor } { en } : & \__whu_use_information:nn { supervisor } { en } \\
%           \__whu_use_information_constant:nn { major } { en } : & \__whu_use_information:nn { major } { en } \\
%           \__whu_use_information_constant:nn { professional-field } { en } : & \__whu_use_information:nn { professional-field } { en }
%         \end{tblr}
%       }
%   }
% \cs_new:Nn \__whu_professional_master_constant_set: 
%   {
%     \__whu_professional_master_constant_initial_set:
%     \__whu_professional_master_constant_additional_set:
%   }
% \cs_new:Nn \__whu_professional_master_constant_additional_set: { }
% \cs_new:Nn \__whu_professional_master_constant_initial_set:
%   {
%     \cs_set:Nn \__whu_cover_zh_thesis_type_format: { \zihao { 2 } \ziju{0.5} }
%       }
%     \cs_set:Nn \__whu_cover_zh_information_content: 
%       {
%         \begin{minipage} [ c ] { 0.72\textwidth }
%           \clist_set:Nx \l__whu_tmpa_clist
%             {
%               \__whu_use_information_constant:nn { author } { zh } ,
%               \__whu_use_information_constant:nn { student-id } { zh } ,
%               \__whu_use_information_constant:nn { supervisor } { zh } ,
%               \__whu_use_information_constant:nn { major } { zh } ,
%             }
%           \clist_set:Nx \l__whu_tmpb_clist
%             {
%               \__whu_use_information:nn { author } { zh },
%               \__whu_use_information:nn { student-id } { zh },
%               \__whu_use_information:nn { supervisor } { zh },
%               \__whu_use_information:nn { major } { zh },
%             }
%           \bool_until_do:nn
%             { \clist_if_empty_p:N \l__whu_tmpa_clist }
%             {
%               \clist_pop:NN \l__whu_tmpa_clist \l__whu_tmpa_tl
%               \clist_pop:NN \l__whu_tmpb_clist \l__whu_tmpb_tl
%               \__whu_spread_box:nn { 4.45cm } { \l__whu_tmpa_tl } :
%               \hspace{1.3em}
%               \l__whu_tmpb_tl
%               \skip_vertical:n { 3ex }
%             }
%         \end{minipage}
%       }
%     \cs_set:Nn \__whu_cover_en_information_content: 
%       {
%         \begin{tblr}
%           {
%             cell{1, 3}{2} = { cmd = \textsc },
%             % hlines, vlines,
%             colspec = { X[1,r] X[1,l] },
%             rowsep = 1.5pt
%           }
%           \__whu_use_information_constant:nn { author } { en } : & \__whu_use_information:nn { author } { en } \\
%           \__whu_use_information_constant:nn { student-id } { en } : & \__whu_use_information:nn { student-id } { en } \\
%           \__whu_use_information_constant:nn { supervisor } { en } : & \__whu_use_information:nn { supervisor } { en } \\
%           \__whu_use_information_constant:nn { major } { en } : & \__whu_use_information:nn { major } { en } \\
%         \end{tblr}
%       }
%   }


% 封面设置
\cs_set:Nn \__whu_cover_zh_head_format: 
  {  \zihao{4} \fangsong  }
\cs_set:Nn \__whu_cover_zh_master_head_content:
  {
    \begin{tblr}
      {
        % hlines,vlines,
        width   = 0.95\textwidth,
        rows    = { f },
        row{2}  = { abovesep += 0.1em },
        colspec = { X[1,l] X[4.6cm] X[1,l] },
        columns = { preto = \__whu_cover_zh_head_format: },
      }
      \__whu_spread_box:nn { 1.5cm } { 分类号 } \__whu_cover_zh_head_underline:n { \__whu_use_information:nn { clc } { zh } }
        & & \__whu_spread_box:nn { 1.5cm } { 密级 } \__whu_cover_zh_head_underline: \\
        \__whu_spread_box:nn { 1.5cm } { UDC } \__whu_cover_zh_head_underline: 
        & & \__whu_spread_box:nn { 1.5cm } { 编号 }  \__whu_cover_zh_head_underline:n { 10486 }
    \end{tblr}
  }


\ProcessKeyOptions [ whu/master ]